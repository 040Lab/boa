#!/bin/bash

PATH=/usr/local/bin:/usr/bin:/bin
SHELL=/bin/bash
_ALL="$@"
_LTD_GID=$(id -nG $USER)
_INTERNAL=NO

if [[ "$_LTD_GID" =~ "lshellg"($) ]] ; then
  if [ "$1" = "-c" ] ; then
    if [[ "$2" =~ "set -m" ]] && [ "$0" = "/bin/sh" ] ; then
      _X_CMD="*c set -m;"
      _Y_CMD=${_ALL#${_X_CMD}}
      _TARGET_CMD="$_Y_CMD"
      _IN_PATH=YES
      _INTERNAL=YES
    else
      if [ "$2" = "/bin/sh" ] ; then
        _X_CMD="*c /bin/sh"
        _Y_CMD=${_ALL#${_X_CMD}}
        _TARGET_CMD="$_Y_CMD"
      else
        _X_CMD="*c"
        _Y_CMD=${_ALL#${_X_CMD}}
        _TARGET_CMD="$_Y_CMD"
      fi
      if [[ "$2" =~ (^)"/usr/" ]] || [[ "$2" =~ (^)"/bin/" ]] ; then
        _IN_PATH=YES
      else
        _WHICH_TEST=$(which $2)
        if [[ "$_WHICH_TEST" =~ (^)"/usr/" ]] || [[ "$_WHICH_TEST" =~ (^)"/bin/" ]] ; then
          _IN_PATH=YES
        else
          _IN_PATH=NO
        fi
      fi
    fi
  else
    _TARGET_CMD="$@"
    if [[ "$1" =~ (^)"/usr/" ]] || [[ "$1" =~ (^)"/bin/" ]] ; then
      _IN_PATH=YES
    else
      _WHICH_TEST=$(which $1)
      if [[ "$_WHICH_TEST" =~ (^)"/usr/" ]] || [[ "$_WHICH_TEST" =~ (^)"/bin/" ]] ; then
        _IN_PATH=YES
      else
        _IN_PATH=NO
      fi
    fi
  fi
  if [ "$_IN_PATH" = "YES" ] ; then
    if [ "$_INTERNAL" = "YES" ] ; then
      exec $_TARGET_CMD
    elif [ "$0" = "/bin/sh" ] || [ "$0" = "/bin/websh" ] ; then
      exec /bin/bash "$@"
    else
      exec $0 "$@"
    fi
    exit 0
  else
    exit 1
  fi
elif [[ "$_LTD_GID" =~ (^)"users www-data"($) ]] || [[ "$_LTD_GID" =~ (^)"aegir www-data users"($) ]] ; then
  if [ "$1" = "-c" ] ; then
    if [[ "$2" =~ "set -m" ]] && [ "$0" = "/bin/sh" ] ; then
      _X_CMD="*c set -m;"
      _Y_CMD=${_ALL#${_X_CMD}}
      _TARGET_CMD="$_Y_CMD"
      _IN_PATH=YES
      _INTERNAL=YES
    else
      if [ "$2" = "/bin/sh" ] ; then
        _X_CMD="*c /bin/sh"
        _Y_CMD=${_ALL#${_X_CMD}}
        _TARGET_CMD="$_Y_CMD"
      else
        _X_CMD="*c"
        _Y_CMD=${_ALL#${_X_CMD}}
        _TARGET_CMD="$_Y_CMD"
      fi
      if [[ "$2" =~ (^)"/usr/" ]] || [[ "$2" =~ (^)"/bin/" ]] || [[ "$2" =~ (^)"/opt/" ]] ; then
        _IN_PATH=YES
      else
        _WHICH_TEST=$(which $2)
        if [[ "$_WHICH_TEST" =~ (^)"/usr/" ]] || [[ "$_WHICH_TEST" =~ (^)"/bin/" ]] || [[ "$_WHICH_TEST" =~ (^)"/opt/" ]] ; then
          _IN_PATH=YES
        else
          _IN_PATH=NO
        fi
      fi
    fi
  else
    _TARGET_CMD="$@"
    if [[ "$1" =~ (^)"/usr/" ]] || [[ "$1" =~ (^)"/bin/" ]] || [[ "$1" =~ (^)"/opt/" ]] ; then
      _IN_PATH=YES
    else
      _WHICH_TEST=$(which $1)
      if [[ "$_WHICH_TEST" =~ (^)"/usr/" ]] || [[ "$_WHICH_TEST" =~ (^)"/bin/" ]] || [[ "$_WHICH_TEST" =~ (^)"/opt/" ]] ; then
        _IN_PATH=YES
      else
        _IN_PATH=NO
      fi
    fi
  fi
  if [ "$_IN_PATH" = "YES" ] ; then
    if [ "$_INTERNAL" = "YES" ] ; then
      exec $_TARGET_CMD
    elif [ "$0" = "/bin/sh" ] || [ "$0" = "/bin/websh" ] ; then
      exec /bin/bash "$@"
    else
      exec $0 "$@"
    fi
    exit 0
  else
    exit 1
  fi
else
  if [ "$0" = "/bin/sh" ] || [ "$0" = "/bin/websh" ] ; then
    exec /bin/bash "$@"
  else
    exec $0 "$@"
  fi
  exit 0
fi
